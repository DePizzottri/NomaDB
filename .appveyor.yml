environment:
  fast_finish: true

  matrix:
  - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    VSPATH: C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC
    BS: cmake
    CMAKE_GENERATOR: '"Visual Studio 14 2015"'

  - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
    VSPATH: C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build
    BS: cmake
    CMAKE_GENERATOR: '"Visual Studio 15 2017"'

platform: x64

configuration:
  - Debug
  - Release

cache:
  # cmake
  - C:\cmake-3.7.2-win32-x86
  # CAF
  - C:\lib\actor-framework\libcaf_core\caf
  - C:\lib\actor-framework\build\lib\%CONFIGURATION%

# prepare dependencies
install:
  # cmake 
  - ps: |
      if (![IO.File]::Exists("C:\cmake-3.7.2-win32-x86\bin\cmake.exe")) {
        pushd c:\
        Start-FileDownload 'https://cmake.org/files/v3.7/cmake-3.7.2-win32-x86.zip'
        7z x -y cmake-3.7.2-win32-x86.zip
        popd
      }
  - call "%VSPATH%"\vcvarsall %PLATFORM%
  - set PATH=C:\cmake-3.7.2-win32-x86\bin;%PATH%;
  # prepare 
  - pushd
  - mkdir c:\lib
  - cd c:\lib
  # CAF
  - ps: |
     if (![IO.File]::Exists("C:\lib\actor-framework\build\lib")) {
       & git clone --branch 0.15.3 https://github.com/actor-framework/actor-framework.git
       cd actor-framework
       mkdir build
       cd build
       & cmake %CMAKE_GENERATOR% -DCMAKE_GENERATOR_PLATFORM=%PLATFORM% -DCAF_NO_BENCHMARKS:BOOL=no -DCAF_NO_EXAMPLES:BOOL=no -DCAF_NO_MEM_MANAGEMENT:BOOL=yes -DCAF_NO_IO:BOOL=yes -DCAF_NO_UNIT_TESTS:BOOL=yes ..
       & msbuild CAF.sln /p:Configuration=%CONFIGURATION% /p:Platform=%PLATFORM%
       cd ../..
     }
  - dir
  # restbed

  #end
  - popd
  
  